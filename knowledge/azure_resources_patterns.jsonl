{"id":"azure-crossplane-managed-identity-403","category":"troubleshooting","symptoms":["Azure Managed Resource shows SYNCED=False","403 Forbidden errors in provider logs","Status condition: The client with object id does not have authorization"],"root_cause":"Crossplane provider's managed identity lacks required RBAC roles on Azure subscription/resource group","investigation":["kubectl get managed -A | grep False","kubectl describe <managed-resource> | grep -A10 'Status Conditions'","Check provider pod logs: kubectl logs -n crossplane-system -l pkg.crossplane.io/provider=provider-azure","Verify managed identity: az identity show --ids <identity-id>","Check role assignments: az role assignment list --assignee <managed-identity-object-id> --all"],"fixes":["Grant required Azure role: az role assignment create --assignee <object-id> --role Contributor --scope /subscriptions/<sub-id>","For specific resources: Use custom roles with minimal permissions","Update ProviderConfig with correct identity: kubectl edit providerconfig default","Wait for Crossplane to reconcile after RBAC changes (~60s)","Check Azure subscription limits if Contributor role exists but still failing"],"related_patterns":["crossplane-managed-synced-false","azure-resource-provider-not-registered"]}
{"id":"azure-resource-provider-not-registered","category":"troubleshooting","symptoms":["Azure resource creation fails via Crossplane","Error: The subscription is not registered to use namespace Microsoft.Network","Crossplane managed resource stuck in Creating"],"root_cause":"Azure subscription doesn't have required resource provider registered","investigation":["kubectl describe <managed-resource> -n <namespace> | grep Error","Check provider registration: az provider show --namespace Microsoft.Network --query registrationState","List all providers: az provider list --query '[].{Provider:namespace, Status:registrationState}' -o table","Review Crossplane provider logs: kubectl logs -n crossplane-system -l pkg.crossplane.io/provider=provider-azure"],"fixes":["Register required provider: az provider register --namespace Microsoft.Network","Wait for registration to complete: az provider show --namespace Microsoft.Network --wait","Common providers needed: Microsoft.Network, Microsoft.Compute, Microsoft.Storage, Microsoft.KeyVault","Verify registration: az provider show --namespace <namespace> | grep Registered","Retry Crossplane reconciliation after registration"],"related_patterns":["azure-crossplane-managed-identity-403","crossplane-managed-synced-false"]}
{"id":"azure-vnet-subnet-address-exhausted","category":"troubleshooting","symptoms":["New pods stuck in Pending with FailedCreatePodSandbox","Error: IP address could not be allocated","AKS node pool scale fails"],"root_cause":"Azure VNet subnet has no available IP addresses for new pods or nodes","investigation":["Check subnet available IPs: az network vnet subnet show --resource-group <rg> --vnet-name <vnet> --name <subnet> --query 'addressPrefix'","List IPs in use: az network vnet subnet list-available-ips --resource-group <rg> --vnet-name <vnet> --name <subnet>","Check AKS pod CIDR: az aks show --resource-group <rg> --name <cluster> --query networkProfile","Review subnet size vs pod count: Calculate IPs needed for max pods per node * node count","Check for stuck IP allocations in Azure portal"],"fixes":["Expand subnet CIDR: az network vnet subnet update --resource-group <rg> --vnet-name <vnet> --name <subnet> --address-prefixes <larger-cidr>","Add additional subnet for new node pool: az aks nodepool add with different subnet","Clean up unused network interfaces: az network nic list --query '[?ipConfigurations[0].subnet.id==`<subnet-id>`]'","For AKS: Consider using Azure CNI Overlay mode for larger pod density","Implement pod autoscaling limits to prevent unbounded growth"],"related_patterns":["aks-node-not-ready","pod-scheduling-failed-insufficient-resources"]}
{"id":"azure-keyvault-secret-access-denied","category":"troubleshooting","symptoms":["Pod fails to start with SecretProviderClass error","Error: failed to get secret from Key Vault","Crossplane ExternalSecret shows SyncError"],"root_cause":"Pod's managed identity or service principal lacks Get/List permissions on Azure Key Vault","investigation":["Check SecretProviderClass: kubectl describe secretproviderclass <name>","Review CSI driver logs: kubectl logs -n kube-system -l app=secrets-store-csi-driver","Verify Key Vault access policies: az keyvault show --name <kv-name> --query properties.accessPolicies","Test access: az keyvault secret show --vault-name <kv-name> --name <secret> --query value","Check managed identity binding: kubectl describe azureidentity <identity>"],"fixes":["Grant Key Vault access: az keyvault set-policy --name <kv-name> --object-id <identity-object-id> --secret-permissions get list","For workload identity: Update federated credential with correct namespace/serviceaccount","Verify AzureIdentityBinding is correct: kubectl get azureidentitybinding","Check Key Vault firewall: az keyvault network-rule list --name <kv-name>","Ensure pod's serviceAccount has azure.workload.identity/client-id annotation"],"related_patterns":["azure-crossplane-managed-identity-403","pod-secret-mount-failed"]}
{"id":"azure-disk-attachment-timeout","category":"troubleshooting","symptoms":["Pod stuck in ContainerCreating","Error: Timeout waiting for volume to attach","AttachVolume.Attach failed for volume with disk attach error"],"root_cause":"Azure disk already attached to different node, node VM stopped/deallocated, or disk in use by another pod","investigation":["Check pod events: kubectl describe pod <pod>","List disk attachments: az disk show --resource-group <rg> --name <disk-name> --query managedBy","Check node status: kubectl get nodes and az vm get-instance-view","Review CSI driver logs: kubectl logs -n kube-system -l app=csi-azuredisk-controller","Verify PVC status: kubectl describe pvc <pvc>"],"fixes":["If disk attached to stopped VM: Detach disk: az vm disk detach --resource-group <rg> --vm-name <vm> --name <disk>","Delete old pod using disk: kubectl delete pod <old-pod> --grace-period=0 --force","For spot VMs: Disk may be attached to deallocated VM - manually detach via Azure portal","Check PV reclaim policy: kubectl get pv <pv> -o yaml | grep reclaimPolicy","Increase attachment timeout in StorageClass volumeBindingMode"],"related_patterns":["persistent-volume-mount-failed","node-disk-pressure","aks-node-not-ready"]}
{"id":"aks-node-not-ready-vmss-upgrade","category":"troubleshooting","symptoms":["AKS nodes showing NotReady","kubectl get nodes shows SchedulingDisabled","Pods evicted and not rescheduling"],"root_cause":"AKS node pool upgrade in progress, VMSS model mismatch, or node image upgrade","investigation":["Check node conditions: kubectl describe node <node> | grep -A10 Conditions","Verify AKS upgrade status: az aks show --resource-group <rg> --name <cluster> --query 'provisioningState'","Check VMSS instances: az vmss list-instances --resource-group <node-rg> --name <vmss>","Review upgrade history: az aks nodepool list --resource-group <rg> --cluster-name <cluster>","Check node events: kubectl get events --field-selector involvedObject.name=<node>"],"fixes":["Wait for upgrade to complete: az aks wait --resource-group <rg> --name <cluster> --updated","If stuck: Cancel upgrade: az aks nodepool upgrade --resource-group <rg> --cluster-name <cluster> --name <nodepool> --node-image-only","Manually cordon/drain stuck node: kubectl drain <node> --ignore-daemonsets --delete-emptydir-data","Update VMSS instances: az vmss update-instances --resource-group <rg> --name <vmss> --instance-ids '*'","Reimagine node: az vmss reimage --resource-group <rg> --name <vmss> --instance-id <id>"],"related_patterns":["node-not-ready","pod-evicted","aks-cluster-upgrading"]}
{"id":"azure-loadbalancer-no-public-ip","category":"troubleshooting","symptoms":["LoadBalancer service stuck in Pending","No external IP assigned","Error: All BackendAddressPools are full"],"root_cause":"Azure Load Balancer quota exhausted, no available public IPs, or NSG blocking traffic","investigation":["Check service status: kubectl describe service <svc> | grep -A5 Events","List Azure LBs: az network lb list --resource-group <node-rg>","Check public IP quota: az network public-ip list --resource-group <rg>","Verify backend pool: az network lb address-pool show --resource-group <rg> --lb-name <lb> --name <pool>","Review NSG rules: az network nsg show --resource-group <rg> --name <nsg>"],"fixes":["Request quota increase for Public IPs: az support tickets create","Use Internal LoadBalancer: Add annotation service.beta.kubernetes.io/azure-load-balancer-internal: true","Share existing LoadBalancer: Use same external IP with different ports","Delete unused LoadBalancer services: kubectl delete svc <unused-svc>","Use Ingress instead of multiple LoadBalancers"],"related_patterns":["service-external-ip-pending","ingress-no-address"]}
{"id":"azure-storage-account-throttling","category":"troubleshooting","symptoms":["Slow PVC mount times","Error: The server is busy. Please retry","Crossplane managed storage account errors with 429 status"],"root_cause":"Azure Storage Account hitting IOPS/throughput limits or API rate limits","investigation":["Check storage metrics: az monitor metrics list --resource <storage-account-id> --metric Transactions","Review throttling: az storage account show --name <account> --query 'primaryEndpoints'","List storage account usage: az storage account show-usage --location <region>","Check Crossplane provider logs: kubectl logs -n crossplane-system -l pkg.crossplane.io/provider=provider-azure | grep 429","Verify storage tier: az storage account show --name <account> --query sku.tier"],"fixes":["Upgrade storage account tier: az storage account update --name <account> --sku Premium_LRS","Increase throughput: az storage account update --name <account> --enable-large-file-share","Add retry logic in Crossplane ProviderConfig","Distribute load across multiple storage accounts","Use Azure Files Premium for high IOPS workloads"],"related_patterns":["persistent-volume-claim-pending","azure-disk-attachment-timeout"]}
{"id":"azure-cosmosdb-crossplane-connection-failed","category":"troubleshooting","symptoms":["Crossplane CosmosDB Account shows SYNCED=False","Connection timeout to CosmosDB endpoint","Error: Failed to reach CosmosDB service"],"root_cause":"CosmosDB firewall blocking Crossplane provider IP, VNet rules misconfigured, or private endpoint not reachable","investigation":["kubectl describe account.cosmosdb.azure.crossplane.io <name> | grep -A10 Status","Check CosmosDB firewall: az cosmosdb show --name <cosmosdb> --resource-group <rg> --query 'ipRules'","List VNet rules: az cosmosdb network-rule list --name <cosmosdb> --resource-group <rg>","Test connectivity from provider pod: kubectl exec -n crossplane-system <provider-pod> -- curl https://<cosmosdb>.documents.azure.com","Review private endpoint: az network private-endpoint show --name <pe> --resource-group <rg>"],"fixes":["Add provider pod IPs to firewall: az cosmosdb update --name <cosmosdb> --resource-group <rg> --ip-range-filter <ip>","Enable VNet rule for AKS subnet: az cosmosdb network-rule add --name <cosmosdb> --resource-group <rg> --subnet <subnet-id>","Use private endpoint: Create in same VNet as AKS","Allow Azure services: az cosmosdb update --name <cosmosdb> --enable-public-network true","Check DNS resolution: kubectl exec <pod> -- nslookup <cosmosdb>.documents.azure.com"],"related_patterns":["crossplane-managed-synced-false","azure-keyvault-secret-access-denied"]}
{"id":"azure-aks-pod-identity-webhook-timeout","category":"troubleshooting","symptoms":["Pod creation slow (30s+ delay)","Error: context deadline exceeded when creating pod","AAD Pod Identity webhook not responding"],"root_cause":"AAD Pod Identity webhook pod unhealthy, certificate expired, or high reconciliation load","investigation":["Check webhook pods: kubectl get pods -n kube-system -l app.kubernetes.io/name=aad-pod-identity","Review webhook logs: kubectl logs -n kube-system -l component=mic","Test webhook response: kubectl get validatingwebhookconfigurations","Check certificate validity: kubectl get secret -n kube-system aad-pod-identity-webhook-cert -o yaml","Monitor reconciliation rate: kubectl logs -n kube-system -l component=mic | grep 'successfully updated'"],"fixes":["Restart webhook pods: kubectl delete pods -n kube-system -l app.kubernetes.io/name=aad-pod-identity","Renew webhook certificate if expired: Delete secret and restart pods","Reduce reconciliation frequency: Update MIC deployment with --reconcile-period=60s","Migrate to Workload Identity (AAD Pod Identity deprecated)","Increase webhook timeout: Update validatingwebhookconfiguration timeoutSeconds"],"related_patterns":["pod-webhook-timeout","azure-keyvault-secret-access-denied"]}
{"id":"azure-application-gateway-ingress-503","category":"troubleshooting","symptoms":["AGIC-managed ingress returns 503 errors","Application Gateway shows unhealthy backend","Intermittent connection failures"],"root_cause":"Backend health probe failing, NSG blocking health probe source, or pod not ready","investigation":["Check AGIC logs: kubectl logs -n kube-system -l app=ingress-azure","View Application Gateway backend health: az network application-gateway show-backend-health --name <agw> --resource-group <rg>","Check health probe config: az network application-gateway probe show --gateway-name <agw> --name <probe> --resource-group <rg>","Review NSG rules: az network nsg rule list --nsg-name <nsg> --resource-group <rg>","Verify pod readiness: kubectl get pods -l app=<backend-app> -o wide"],"fixes":["Allow AzureLoadBalancer health probes in NSG: Add rule for source tag AzureLoadBalancer","Update health probe path: kubectl edit ingress <ingress> - add annotation appgw.ingress.kubernetes.io/health-probe-path","Increase probe timeout: appgw.ingress.kubernetes.io/health-probe-timeout: '30'","Fix pod readiness probe: kubectl edit deployment <app>","Verify backend pool members: az network application-gateway address-pool show"],"related_patterns":["ingress-returning-503","azure-loadbalancer-no-public-ip"]}
{"id":"azure-acr-image-pull-authentication-failed","category":"troubleshooting","symptoms":["ImagePullBackOff with authentication error","Error: failed to authorize: failed to fetch anonymous token","Cannot pull from Azure Container Registry"],"root_cause":"AKS service principal/managed identity lacks AcrPull role, or ACR admin disabled","investigation":["Check image pull error: kubectl describe pod <pod> | grep -A5 Events","Verify ACR role assignment: az role assignment list --assignee <aks-identity-id> --scope /subscriptions/<sub>/resourceGroups/<rg>/providers/Microsoft.ContainerRegistry/registries/<acr>","Test ACR login: az acr login --name <acr>","Check ACR admin status: az acr show --name <acr> --query adminUserEnabled","Review imagePullSecrets: kubectl get serviceaccount default -o yaml"],"fixes":["Grant AcrPull role to AKS: az aks update --name <cluster> --resource-group <rg> --attach-acr <acr-name>","For managed identity: az role assignment create --assignee <identity> --role AcrPull --scope <acr-resource-id>","Enable ACR admin (not recommended): az acr update --name <acr> --admin-enabled true","Create imagePullSecret: kubectl create secret docker-registry acr-secret --docker-server=<acr>.azurecr.io --docker-username=<sp-id> --docker-password=<sp-password>","Use workload identity: Annotate serviceAccount with azure.workload.identity/client-id"],"related_patterns":["image-pull-backoff","azure-crossplane-managed-identity-403"]}
{"id":"azure-managed-disk-snapshot-failed","category":"troubleshooting","symptoms":["VolumeSnapshot stuck in Pending","Error: Failed to create snapshot","CSI snapshot controller errors"],"root_cause":"Disk in use and snapshot requires detach, insufficient permissions, or quota exceeded","investigation":["Check VolumeSnapshot: kubectl describe volumesnapshot <snapshot>","Review snapshot controller logs: kubectl logs -n kube-system -l app=snapshot-controller","Verify disk state: az disk show --name <disk> --resource-group <rg> --query diskState","Check snapshot quota: az snapshot list --query 'length(@)'","List CSI snapshots: kubectl get volumesnapshotclass"],"fixes":["Ensure disk is attached (snapshots require attached disk for Azure): Verify pod using PVC is running","Grant Snapshot Contributor role: az role assignment create --assignee <identity> --role 'Disk Snapshot Contributor'","Increase snapshot quota: Request via Azure support","Use VolumeSnapshotClass with correct driver: kubectl get volumesnapshotclass -o yaml | grep driver","For detached disk: Attach to any pod before snapshot"],"related_patterns":["persistent-volume-claim-pending","azure-disk-attachment-timeout"]}
{"id":"azure-vnet-peering-routes-missing","category":"troubleshooting","symptoms":["Cannot reach pods in peered VNet","Cross-VNet service discovery fails","Timeout connecting to remote cluster"],"root_cause":"VNet peering not configured for gateway transit, route tables blocking traffic, or NSG rules incorrect","investigation":["Check VNet peering status: az network vnet peering show --name <peering> --resource-group <rg> --vnet-name <vnet> --query peeringState","List route tables: az network route-table route list --resource-group <rg> --route-table-name <rt>","Review NSG rules: az network nsg rule list --nsg-name <nsg> --resource-group <rg> | grep -i deny","Test connectivity: kubectl run test-pod --image=busybox --rm -it -- wget -O- http://<remote-service>","Check effective routes: az network nic show-effective-route-table --name <nic> --resource-group <rg>"],"fixes":["Enable gateway transit: az network vnet peering update --name <peering> --resource-group <rg> --vnet-name <vnet> --set allowGatewayTransit=true useRemoteGateways=true","Add route to remote CIDR: az network route-table route create --route-table-name <rt> --name to-remote-vnet --address-prefix <remote-cidr> --next-hop-type VnetPeering","Update NSG to allow traffic: az network nsg rule create --nsg-name <nsg> --name allow-peered-vnet --priority 100 --source-address-prefixes <remote-cidr> --destination-port-ranges '*' --access Allow","Verify both sides of peering configured: Check peering in both VNets","For AKS: Ensure subnet route tables don't override peering routes"],"related_patterns":["service-dns-resolution-failed","pod-network-connectivity-issues"]}
{"id":"azure-spot-vm-eviction-handling","category":"troubleshooting","symptoms":["Spot VMs frequently evicted","Pods not rescheduling after node eviction","Node pool shows 0 nodes after eviction"],"root_cause":"Azure spot price exceeded max price, capacity unavailable, or eviction policy set to Delete","investigation":["Check spot eviction events: az vm get-instance-view --name <vm> --resource-group <rg> --query 'instanceView.platformFaultDomain'","Review node pool spot config: az aks nodepool show --resource-group <rg> --cluster-name <cluster> --name <nodepool> --query spotMaxPrice","List recent evictions: kubectl get events --all-namespaces --sort-by='.lastTimestamp' | grep Evicted","Check spot price history: az vm list-skus --location <region> --size <vm-size> --query '[].capabilities'","Monitor pod scheduling: kubectl get pods --all-namespaces --field-selector status.phase=Pending"],"fixes":["Set max price to -1 (pay up to regular price): az aks nodepool update --resource-group <rg> --cluster-name <cluster> --name <nodepool> --spot-max-price -1","Change eviction policy to Deallocate: az aks nodepool update --eviction-policy Deallocate","Use pod disruption budgets: kubectl create pdb <pdb> --selector app=<app> --min-available=1","Implement node affinity to prefer regular nodes: Add nodeAffinity with spot=true as preferred","Add regular node pool as fallback: az aks nodepool add with standard priority"],"related_patterns":["pod-evicted","node-not-ready","aks-node-not-ready-vmss-upgrade"]}
{"id":"azure-policy-addon-blocking-deployment","category":"troubleshooting","symptoms":["Pod creation blocked with admission webhook error","Error: Azure Policy denied the request","Deployment fails with policy violation"],"root_cause":"Azure Policy configured on AKS cluster blocking non-compliant resources","investigation":["Check policy violations: az policy state list --resource <cluster-resource-id> --filter 'complianceState eq Non-compliant'","Review gatekeeper logs: kubectl logs -n gatekeeper-system -l control-plane=controller-manager","List constraints: kubectl get constraints","Describe webhook error: kubectl describe replicaset <rs> | grep -A10 Events","View policy assignments: az policy assignment list --resource-group <rg>"],"fixes":["Exclude namespace from policy: Add label to namespace kubectl label namespace <ns> admission.policy.azure.com/ignore=true","Update deployment to comply: Add required labels, resource limits, or security context","Temporarily disable policy: az policy assignment delete --name <assignment>","Use policy exemption: az policy exemption create --name <exemption> --policy-assignment <assignment> --resource-group <rg>","Review constraint templates: kubectl get constrainttemplates -o yaml"],"related_patterns":["pod-webhook-timeout","deployment-pods-not-ready"]}
{"id":"azure-managed-prometheus-high-cardinality","category":"troubleshooting","symptoms":["Prometheus ingestion throttled","Error: Sample limit exceeded","Missing metrics in Azure Monitor"],"root_cause":"Too many unique metric labels (high cardinality), exceeding Azure Monitor Managed Prometheus limits","investigation":["Check ingestion rate: kubectl logs -n kube-system -l app=ama-metrics","View cardinality: kubectl port-forward -n kube-system svc/ama-metrics-prometheus 9090:9090 then query topk(20, count by (__name__)({__name__=~'.+'}))","Review metric relabel configs: kubectl get configmap -n kube-system ama-metrics-prometheus-config -o yaml","Check Azure Monitor metrics quota: az monitor metrics list-definitions --resource <cluster-id>","Identify high-cardinality labels: Query for count by (label_name) in Prometheus"],"fixes":["Drop high-cardinality labels: Add metricRelabelings to drop labels like pod_id, container_id","Reduce scrape interval: Update prometheus.yml scrape configs","Filter metrics: Use metric_relabel_configs to drop unused metrics","Increase quota: Contact Azure support for Managed Prometheus limits","Use metric aggregation: Pre-aggregate metrics before ingestion"],"related_patterns":["prometheus-high-memory-usage","monitoring-metrics-missing"]}
{"id":"azure-service-bus-crossplane-queue-not-ready","category":"troubleshooting","symptoms":["Crossplane ServiceBusQueue stuck in Creating","Error: Namespace does not exist","SYNCED=False on queue resource"],"root_cause":"ServiceBus namespace not ready, Crossplane provider misconfigured, or RBAC missing","investigation":["kubectl describe queue.servicebus.azure.crossplane.io <queue> | grep -A10 Status","Check namespace status: az servicebus namespace show --name <namespace> --resource-group <rg> --query provisioningState","Verify Crossplane provider: kubectl get providers.pkg.crossplane.io","Review provider logs: kubectl logs -n crossplane-system -l pkg.crossplane.io/provider=provider-azure","Check role assignments: az role assignment list --assignee <provider-identity> --scope /subscriptions/<sub>/resourceGroups/<rg>"],"fixes":["Wait for namespace to be Active: az servicebus namespace show --name <namespace> --wait","Grant Service Bus Data Owner role: az role assignment create --assignee <identity> --role 'Azure Service Bus Data Owner' --scope <namespace-id>","Update ProviderConfig with correct credentials: kubectl edit providerconfig default","Verify queue references correct namespace: Check spec.forProvider.namespaceName in queue YAML","Delete and recreate if stuck: kubectl delete queue <queue> then reapply"],"related_patterns":["crossplane-managed-synced-false","azure-crossplane-managed-identity-403"]}
{"id":"azure-frontdoor-backend-unhealthy","category":"troubleshooting","symptoms":["Azure Front Door showing backend as unhealthy","Traffic not reaching AKS cluster","Health probe failures in Front Door logs"],"root_cause":"NSG blocking Front Door health probe IPs, backend health probe misconfigured, or backend pods not responding","investigation":["Check Front Door backend health: az network front-door backend-pool show --front-door-name <fd> --name <pool> --resource-group <rg>","Review health probe settings: az network front-door probe show --front-door-name <fd> --name <probe> --resource-group <rg>","Verify NSG allows Front Door: az network nsg rule list --nsg-name <nsg> --resource-group <rg> | grep AzureFrontDoor","Test backend directly: curl -H 'Host: <domain>' http://<backend-ip>:<port>/health","Check AKS ingress: kubectl describe ingress <ingress>"],"fixes":["Allow Front Door service tag in NSG: az network nsg rule create --nsg-name <nsg> --name allow-frontdoor --source-address-prefixes AzureFrontDoor.Backend --destination-port-ranges 80 443 --access Allow --priority 100","Update health probe path: az network front-door probe update --front-door-name <fd> --name <probe> --path /healthz","Increase probe interval: az network front-door probe update --interval-in-seconds 30","Verify backend pool address matches ingress: az network front-door backend-pool backend list","Add X-Azure-FDID header check in ingress for security"],"related_patterns":["azure-application-gateway-ingress-503","ingress-returning-503"]}
{"id":"azure-blob-storage-crossplane-lifecycle-policy-failed","category":"troubleshooting","symptoms":["Crossplane BlobContainer lifecycle policy not applying","Error: Lifecycle management policy format invalid","Objects not being deleted/tiered as expected"],"root_cause":"Lifecycle policy JSON syntax error, incorrect blob type filters, or storage account tier doesn't support lifecycle management","investigation":["kubectl describe container.storage.azure.crossplane.io <container> | grep -A20 Status","Validate policy: az storage account management-policy show --account-name <storage> --resource-group <rg>","Check storage account tier: az storage account show --name <storage> --query sku.tier","Review Crossplane provider logs: kubectl logs -n crossplane-system -l pkg.crossplane.io/provider=provider-azure | grep lifecycle","Test policy manually: az storage account management-policy create --account-name <storage> --policy @policy.json"],"fixes":["Fix policy JSON format: Ensure rules have valid daysAfterModificationGreaterThan values","Upgrade to Premium tier if needed: az storage account update --name <storage> --sku Premium_LRS","Verify blob type filters: Use blockBlob for general purpose v2 accounts","Apply policy directly first: Test with az CLI before using Crossplane","Check policy limits: Max 100 rules per storage account"],"related_patterns":["azure-storage-account-throttling","crossplane-managed-synced-false"]}
{"id":"azure-aks-kubelet-identity-not-found","category":"troubleshooting","symptoms":["New node pool creation fails","Error: User assigned identity not found","Kubelet identity missing in AKS"],"root_cause":"Managed identity deleted outside AKS, identity not in correct resource group, or identity RBAC revoked","investigation":["Check AKS identity: az aks show --resource-group <rg> --name <cluster> --query identityProfile","List identities: az identity list --resource-group <node-rg>","Verify identity exists: az identity show --ids <identity-id>","Check role assignments: az role assignment list --assignee <kubelet-identity-object-id>","Review AKS activity logs: az monitor activity-log list --resource-group <rg> --caller <user>"],"fixes":["Recreate kubelet identity: az identity create --name <cluster>-agentpool --resource-group <node-rg>","Reassign identity to AKS: az aks update --resource-group <rg> --name <cluster> --enable-managed-identity --assign-identity <identity-id>","Grant required roles: az role assignment create --assignee <identity> --role 'Virtual Machine Contributor' --scope <subscription-id>","If identity deleted: Redeploy AKS cluster (identity cannot be easily recovered)","Check Azure policy not blocking identity creation"],"related_patterns":["azure-crossplane-managed-identity-403","aks-node-not-ready-vmss-upgrade"]}
