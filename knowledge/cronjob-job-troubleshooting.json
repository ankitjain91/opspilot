{
  "id": "cronjob-job-troubleshooting",
  "title": "CronJob / Job Failures",
  "category": "troubleshooting",
  "tags": ["cronjob", "job", "batch", "backoff", "deadline"],
  "summary": "Fix batch workloads that fail, don’t run, or pile up: backoff limits, deadlines, schedules, and cleanup.",
  "error_patterns": [
    "BackoffLimitExceeded",
    "DeadlineExceeded",
    "no Jobs created",
    "concurrencyPolicy",
    "suspend: true"
  ],
  "recommended_tools": [
    "DESCRIBE Job <ns>/<name>",
    "DESCRIBE CronJob <ns>/<name>",
    "LIST_ALL Job <ns>",
    "GET_LOGS job/<name> -n <ns>",
    "GET_EVENTS <ns>"
  ],
  "quick_fix": "Describe the Job/CronJob to see failures; check pod logs; adjust backoffLimit/activeDeadlineSeconds; validate schedule/concurrencyPolicy.",
  "symptoms": [
    "Jobs fail repeatedly (BackoffLimitExceeded)",
    "Jobs time out (DeadlineExceeded)",
    "CronJob not creating Jobs",
    "CronJob creates overlapping Jobs",
    "Old Jobs/Pods not cleaned up"
  ],
  "decision_tree": [
    "If BackoffLimitExceeded → inspect pod logs; fix app/config; raise backoffLimit only if transient.",
    "If DeadlineExceeded → increase activeDeadlineSeconds or optimize job runtime.",
    "If no Jobs created → validate cron schedule; check suspend/startingDeadlineSeconds; controller health.",
    "If overlapping → set concurrencyPolicy: Forbid or Replace; increase interval.",
    "If too many old Jobs → set history limits and ttlSecondsAfterFinished."
  ],
  "common_causes": [
    {
      "cause": "Application/config error",
      "description": "Job pods exit non-zero repeatedly.",
      "diagnosis": "kubectl logs job/<name> -n <ns>; describe job for conditions.",
      "fix": "Fix app/config; optionally increase backoffLimit if transient."
    },
    {
      "cause": "Schedule issues",
      "description": "Cron expression invalid or missed deadlines; suspend true.",
      "diagnosis": "Describe cronjob; check suspend/startingDeadlineSeconds; validate cron at crontab.guru.",
      "fix": "Correct schedule; set suspend: false; adjust startingDeadlineSeconds."
    },
    {
      "cause": "Overlapping runs",
      "description": "Jobs pile up when previous hasn’t finished.",
      "diagnosis": "Multiple Jobs with same cronjob-name label.",
      "fix": "Set concurrencyPolicy: Forbid/Replace; increase interval; speed up job."
    },
    {
      "cause": "No cleanup",
      "description": "Old Jobs/Pods consume resources.",
      "diagnosis": "Many completed/failed Jobs present.",
      "fix": "Set successfulJobsHistoryLimit/failedJobsHistoryLimit; use ttlSecondsAfterFinished."
    }
  ],
  "diagnostic_commands": [
    "kubectl describe job -n <ns> <name>",
    "kubectl describe cronjob -n <ns> <name>",
    "kubectl get pods -l job-name=<job> -n <ns>",
    "kubectl logs job/<name> -n <ns>",
    "kubectl get jobs -n <ns> | wc -l"
  ],
  "investigation_flow": [
    "1) Describe Job/CronJob to see conditions/events (BackoffLimitExceeded/DeadlineExceeded).",
    "2) Get pod logs for the job: kubectl logs job/<name> -n <ns> (--previous if retries).",
    "3) If BackoffLimitExceeded → fix app/config; adjust backoffLimit if needed.",
    "4) If DeadlineExceeded → raise activeDeadlineSeconds or optimize job.",
    "5) If CronJob not running → validate cron; ensure suspend: false; startingDeadlineSeconds reasonable.",
    "6) If overlapping → set concurrencyPolicy: Forbid/Replace; adjust schedule.",
    "7) Add history limits/ttlSecondsAfterFinished to clean old Jobs."
  ]
}
