{
  "id": "configmap-secret-troubleshooting",
  "title": "ConfigMap & Secret Mount/Env Issues",
  "category": "troubleshooting",
  "tags": [
    "configmap",
    "secret",
    "mount",
    "env",
    "file not found",
    "permission"
  ],
  "summary": "Fix missing/broken ConfigMap/Secret references: wrong names/keys, mount paths, permissions.",
  "error_patterns": [
    "ConfigMap .* not found",
    "Secret .* not found",
    "no such file or directory",
    "permission denied",
    "could not find key"
  ],
  "recommended_tools": [
    "DESCRIBE Pod <ns>/<pod>",
    "LIST_ALL ConfigMap <ns>",
    "LIST_ALL Secret <ns>",
    "GET_LOGS <ns>/<pod>",
    "SEARCH_KNOWLEDGE configmap secret mount"
  ],
  "quick_fix": "Verify names/keys: LIST_ALL ConfigMap/Secret; ensure volumeMount/envFrom matches. Fix key names and redeploy.",
  "symptoms": [
    "Pods fail to start with missing file/key errors",
    "Mount path empty or missing files",
    "Env var from ConfigMap/Secret is empty"
  ],
  "decision_tree": [
    "If resource not found → correct name/namespace; ensure it exists before pod starts.",
    "If key missing → align key names in data[] with items/env valueFrom.",
    "If permission denied → check fsGroup/runAsUser; adjust permissions or use fsGroup.",
    "If mount empty → ensure resource exists in same namespace; check items paths."
  ],
  "common_causes": [
    {
      "cause": "Wrong name/namespace",
      "description": "Refers to ConfigMap/Secret that doesn’t exist in ns.",
      "diagnosis": "LIST_ALL ConfigMap/Secret; compare to pod spec.",
      "fix": "Create in correct ns or adjust reference."
    },
    {
      "cause": "Key mismatch",
      "description": "Key in volume/envFrom not present in resource.",
      "diagnosis": "Inspect data keys; compare to items/env.",
      "fix": "Add correct key or update pod spec to existing key."
    },
    {
      "cause": "Permissions/fsGroup",
      "description": "Mounted files inaccessible to process user.",
      "diagnosis": "Logs show permission denied; check runAsUser/fsGroup.",
      "fix": "Set fsGroup/runAsUser; adjust file mode via defaultMode/items."
    }
  ],
  "diagnostic_commands": [
    "kubectl describe pod -n <ns> <pod> | sed -n '/Volumes/,$p'",
    "kubectl get configmap -n <ns> <name> -o yaml",
    "kubectl get secret -n <ns> <name> -o yaml",
    "kubectl logs -n <ns> <pod> --previous | head -n 100"
  ],
  "investigation_flow": [
    "1) Describe pod (Volumes/env) to see referenced ConfigMap/Secret names/keys.",
    "2) LIST_ALL ConfigMap/Secret in ns; ensure names/keys exist.",
    "3) If missing keys → align items/envFrom with actual keys.",
    "4) If permission issues → set fsGroup/runAsUser; adjust defaultMode.",
    "5) Restart pod; confirm mounts/env populated and app starts."
  ]
}
