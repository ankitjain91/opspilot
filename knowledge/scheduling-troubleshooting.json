{
  "id": "scheduling-troubleshooting",
  "title": "Pending / Unschedulable Pods",
  "category": "troubleshooting",
  "tags": [
    "scheduling",
    "pending",
    "unschedulable",
    "nodeaffinity",
    "taint",
    "toleration",
    "resources",
    "nodeselector",
    "pvc"
  ],
  "summary": "Detailed steps to resolve Pending pods: capacity, selectors/affinity, taints/tolerations, PVC binding, priorities.",
  "error_patterns": [
    "0/\\d+ nodes are available",
    "Insufficient (cpu|memory)",
    "didn't match Pod's node selector",
    "node(s) had taint",
    "node(s) didn't match Pod's (node affinity|node selector)",
    "preemption",
    "persistentvolumeclaim .* not found",
    "no persistent volumes available"
  ],
  "recommended_tools": [
    "DESCRIBE Pod <ns>/<pod>",
    "LIST_ALL Node",
    "GET_EVENTS <ns>",
    "TOP_PODS",
    "LIST_ALL PVC <ns>"
  ],
  "quick_fix": "kubectl describe pod -n <ns> <pod> | sed -n '/Events/,$p' — follow the scheduling reason; adjust resources/selectors/taints accordingly.",
  "symptoms": [
    "Pod stuck in Pending",
    "Events show FailedScheduling",
    "Messages like 'Insufficient cpu/memory', 'didn't match node selector', 'had taint'"
  ],
  "decision_tree": [
    "If Events show 'Insufficient cpu/memory' → reduce requests or add nodes; check TOP_PODS/cluster capacity.",
    "If 'didn't match node selector/affinity' → align pod selectors/affinity with node labels or adjust rules.",
    "If 'had taint' → add tolerations matching taints or use different nodes.",
    "If PVC not bound/not found → bind/create correct PV/StorageClass; ensure accessModes/size match.",
    "If preemption blocking → adjust priorityClassName or increase capacity."
  ],
  "common_causes": [
    {
      "cause": "Insufficient resources",
      "description": "No node meets requested CPU/memory.",
      "diagnosis": "Events show 'Insufficient cpu/memory'; check requests/limits vs node allocatable.",
      "fix": "Lower requests, right-size workloads, or add nodes."
    },
    {
      "cause": "Selector/Affinity mismatch",
      "description": "Pod constraints exclude all nodes.",
      "diagnosis": "Events mention node selector/affinity mismatch; compare pod spec to node labels.",
      "fix": "Update node labels or relax selectors/affinity."
    },
    {
      "cause": "Taints without tolerations",
      "description": "Nodes tainted; pod lacks tolerations.",
      "diagnosis": "Events show 'had taint'; inspect node taints.",
      "fix": "Add matching tolerations or schedule to untainted nodes."
    },
    {
      "cause": "PVC not bound",
      "description": "Volume claim pending or missing.",
      "diagnosis": "Events mention PVC not found/not bound; kubectl get pvc shows Pending.",
      "fix": "Create/bind PV with matching size/class/mode; correct PVC name in pod spec."
    },
    {
      "cause": "Priority/preemption",
      "description": "Higher priority pods block scheduling.",
      "diagnosis": "Events include preemption; check priorityClassName.",
      "fix": "Adjust priorities or add capacity."
    }
  ],
  "diagnostic_commands": [
    "kubectl describe pod -n <ns> <pod> | sed -n '/Events/,$p'",
    "kubectl get nodes --show-labels",
    "kubectl describe node <node> | sed -n '/Taints/,+5p'",
    "kubectl describe node <node> | sed -n '/Allocated resources/,+10p'",
    "kubectl get pvc -n <ns> && kubectl describe pvc -n <ns> <pvc>",
    "kubectl top nodes && kubectl top pods -A | head -n 30"
  ],
  "investigation_flow": [
    "1) Identify pod: FIND_ISSUES or LIST_ALL Pod to get <ns>/<pod>.",
    "2) Describe pod for scheduling reason: kubectl describe pod -n <ns> <pod> | sed -n '/Events/,$p'.",
    "3) If Insufficient cpu/memory → right-size requests/limits or add capacity; verify with kubectl top nodes/pods.",
    "4) If selector/affinity mismatch → compare spec.nodeSelector/affinity to kubectl get nodes --show-labels; adjust labels or rules.",
    "5) If taints → kubectl describe node <node> (Taints); add tolerations or use other nodes.",
    "6) If PVC issues → kubectl get/describe pvc -n <ns>; ensure Bound status and correct name/class/size.",
    "7) If preemption/priority → review priorityClassName; increase capacity or lower competing priorities.",
    "8) Re-run scheduling (delete pod or rollout restart) after fixes; confirm pod goes Running/Ready."
  ]
}
