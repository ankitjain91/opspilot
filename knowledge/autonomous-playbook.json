{
    "id": "autonomous-playbook",
    "title": "Autonomous Cluster Debugging Playbook",
    "category": "playbook",
    "tags": [
        "autonomy",
        "debugging",
        "playbook",
        "guide",
        "investigation"
    ],
    "summary": "Step-by-step master guide for autonomous agents to debug the entire cluster without human intervention.",
    "symptoms": [
        "general health check",
        "cluster debugging",
        "find all issues",
        "autonomous scan"
    ],
    "investigation_flow": [
        "1. HIGH LEVEL SCAN: Run CLUSTER_HEALTH and FIND_ISSUES to identify all unhealthy resources.",
        "2. EVENT ANALYSIS: Run GET_EVENTS --all-namespaces to catch recent warnings.",
        "3. DEEP DIVE (Parallel): For every CrashLoopBackOff pod found, immediately run GET_LOGS --previous.",
        "4. DEEP DIVE (Parallel): For every Pending pod found, immediately run DESCRIBE to check events/scheduler.",
        "5. NODE CHECK: If Pending pods exist, check TOP_NODES or DESCRIBE NODE to verify capacity.",
        "6. PLATFORM CHECK: Run GET_CROSSPLANE and GET_ISTIO to verify platform components.",
        "7. KNOWLEDGE MATCH: For specific errors found in logs, run SEARCH_KNOWLEDGE with the error message.",
        "8. ADVANCED ANALYSIS: Use RUN_BASH for complex queries like filtering, sorting, or JSON extraction.",
        "9. SYNTHESIS: Correlate findings. Example: 'Pending Pods' + 'High CPU Node' = 'Cluster Full'."
    ],
    "diagnostic_commands": [
        "FIND_ISSUES",
        "GET_EVENTS",
        "CLUSTER_HEALTH",
        "TOP_PODS --all-namespaces"
    ],
    "advanced_tools": {
        "description": "Power tools for complex analysis when basic tools aren't enough",
        "tools": [
            {
                "name": "RUN_BASH",
                "description": "Execute shell commands with pipes and filters (read-only)",
                "examples": [
                    "RUN_BASH kubectl get pods -A -o json | jq '.items[] | select(.status.phase==\"Pending\")'",
                    "RUN_BASH kubectl get events -A --sort-by='.lastTimestamp' | grep -i error | tail -20",
                    "RUN_BASH kubectl top pods -A --sort-by=memory | head -10",
                    "RUN_BASH helm list -A --failed"
                ],
                "when_to_use": "When you need to filter, sort, or extract specific fields from kubectl output"
            },
            {
                "name": "READ_FILE",
                "description": "Read local YAML/config files",
                "examples": [
                    "READ_FILE ./deployment.yaml",
                    "READ_FILE /etc/kubernetes/manifests/kube-apiserver.yaml"
                ],
                "when_to_use": "When debugging manifests or checking local configuration files"
            },
            {
                "name": "FETCH_URL",
                "description": "Fetch documentation or raw YAML from web",
                "examples": [
                    "FETCH_URL https://raw.githubusercontent.com/org/repo/main/deploy.yaml"
                ],
                "when_to_use": "When you need to reference external documentation or compare against upstream manifests"
            },
            {
                "name": "WEB_SEARCH",
                "description": "Search the web for error messages or unfamiliar issues",
                "examples": [
                    "WEB_SEARCH pod crashloopbackoff exit code 137 OOM",
                    "WEB_SEARCH kubernetes OCI runtime create failed permission denied"
                ],
                "when_to_use": "When you encounter an unfamiliar error message and knowledge base has no match"
            }
        ]
    },
    "autonomous_checks": [
        {
            "condition": "CrashLoopBackOff",
            "action": "GET_LOGS <ns> <pod> --previous"
        },
        {
            "condition": "Pending",
            "action": "DESCRIBE Pod <ns> <pod>"
        },
        {
            "condition": "ImagePullBackOff",
            "action": "DESCRIBE Pod <ns> <pod>"
        },
        {
            "condition": "DeviceNotFound",
            "action": "DESCRIBE Pod <ns> <pod>"
        },
        {
            "condition": "Multiple pods failing",
            "action": "RUN_BASH kubectl get pods -A --field-selector=status.phase!=Running -o json | jq '.items[] | {name:.metadata.name,ns:.metadata.namespace,status:.status.phase}'"
        },
        {
            "condition": "Need to find recent errors",
            "action": "RUN_BASH kubectl get events -A --sort-by='.lastTimestamp' | grep -iE 'error|fail|crash' | tail -30"
        }
    ],
    "tool_combinations": [
        {
            "pattern": "Filter then deep-dive",
            "description": "First filter to find problematic resources, then DESCRIBE each",
            "example": "RUN_BASH kubectl get pods -A --field-selector=status.phase=Pending -o name â†’ then DESCRIBE each"
        },
        {
            "pattern": "JSON extraction",
            "description": "Use jq to extract specific fields for analysis",
            "example": "RUN_BASH kubectl get deploy -A -o json | jq '.items[] | select(.status.replicas != .status.readyReplicas)'"
        },
        {
            "pattern": "Event timeline",
            "description": "Sort events by time and filter for errors",
            "example": "RUN_BASH kubectl get events -A --sort-by='.lastTimestamp' | grep -i error | tail -30"
        }
    ],
    "quick_fix": "Follow the investigation flow to identify root causes. Use advanced tools when basic tools aren't providing enough insight."
}