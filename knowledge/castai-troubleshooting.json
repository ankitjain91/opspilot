{
  "id": "castai-troubleshooting",
  "title": "CAST AI Troubleshooting",
  "category": "troubleshooting",
  "tags": [
    "castai",
    "autoscaling",
    "provisioning",
    "nodes",
    "spot"
  ],
  "summary": "Investigate CAST AI autoscaling/provisioning issues: controllers, cloud creds, quotas, and node health.",
  "error_patterns": [
    "castai-controller",
    "failed to provision",
    "quota",
    "insufficient capacity",
    "cloud credentials"
  ],
  "recommended_tools": [
    "GET_CASTAI",
    "GET_EVENTS castai-system",
    "RUN_KUBECTL logs -n castai-system deploy/castai-controller",
    "RUN_KUBECTL get nodes"
  ],
  "quick_fix": "Check castai-controller logs/events; ensure cloud credentials and quotas are sufficient; verify node provisioning status.",
  "symptoms": [
    "Autoscaling not adding nodes",
    "Provisioning failures",
    "Spot/cluster imbalance"
  ],
  "decision_tree": [
    "If controller not running → fix deployment/permissions.",
    "If quota/capacity errors → adjust cloud quotas or instance types.",
    "If creds invalid → update CAST AI cloud credentials/permissions.",
    "If nodes added but not Ready → debug node readiness (kubelet/CNI)."
  ],
  "common_causes": [
    {
      "cause": "Controller down",
      "description": "castai-controller not running.",
      "diagnosis": "kubectl get pods -n castai-system.",
      "fix": "Restart/fix controller deployment."
    },
    {
      "cause": "Cloud quota/capacity",
      "description": "Provider quota exhausted or no capacity for requested type.",
      "diagnosis": "Logs show quota/insufficient capacity.",
      "fix": "Increase quotas; use different instance sizes/zones."
    },
    {
      "cause": "Credentials/permissions",
      "description": "Cloud creds invalid/insufficient.",
      "diagnosis": "Controller logs show auth errors.",
      "fix": "Update credentials/permissions in CAST AI config."
    }
  ],
  "diagnostic_commands": [
    "kubectl get pods -n castai-system",
    "kubectl logs -n castai-system deploy/castai-controller | tail -n 100",
    "kubectl get events -n castai-system --sort-by=.lastTimestamp | tail -n 30",
    "kubectl get nodes"
  ],
  "investigation_flow": [
    "1) Check castai-system pods/events for controller health.",
    "2) Review controller logs for quota/auth/capacity errors.",
    "3) Verify cloud credentials/permissions and quotas.",
    "4) If nodes provisioned but NotReady → debug node readiness (CNI/kubelet).",
    "5) Confirm autoscaling adds ready nodes; workloads schedule."
  ]
}
