{
  "id": "resource-provisioning",
  "title": "Resource Provisioning Failures (Crossplane/Controllers)",
  "category": "troubleshooting",
  "tags": [
    "crossplane",
    "provisioning",
    "controllers",
    "cloud",
    "crd",
    "reconcile"
  ],
  "summary": "Debug managed resource provisioning (Crossplane/CRDs): controller health, events, cloud API errors, and credentials.",
  "error_patterns": [
    "Reconcile error",
    "failed to create",
    "failed to update",
    "cannot authenticate",
    "rate limit",
    "quota exceeded"
  ],
  "recommended_tools": [
    "GET_CROSSPLANE",
    "RUN_KUBECTL get managed -A",
    "GET_EVENTS <ns>",
    "DESCRIBE <kind> <ns> <name>",
    "SEARCH_KNOWLEDGE crossplane provisioning"
  ],
  "quick_fix": "Check managed resource status/conditions; inspect controller logs and events; verify cloud credentials and quotas; retry after fixing.",
  "symptoms": [
    "Managed resources not Ready",
    "Provisioning stuck in Creating/Deleting",
    "Cloud resources not created/updated"
  ],
  "decision_tree": [
    "If controller pods unhealthy → fix controller deployment and RBAC.",
    "If auth/quota errors in events/status → fix credentials/quota in cloud account.",
    "If CRD missing → install CRDs/providers; reapply compositions.",
    "If rate limit → back off and retry; adjust reconcile intervals."
  ],
  "common_causes": [
    {
      "cause": "Controller not running/healthy",
      "description": "Provider/controller pods crash or missing.",
      "diagnosis": "GET_CROSSPLANE; check provider pods.",
      "fix": "Restart/fix provider deployments; ensure correct version and creds."
    },
    {
      "cause": "Credentials/auth failure",
      "description": "Cloud creds invalid/expired.",
      "diagnosis": "Events/status show auth errors; cloud API denied.",
      "fix": "Refresh credentials/secrets; validate permissions."
    },
    {
      "cause": "Quota/rate limiting",
      "description": "Cloud API rejects due to quota/limits.",
      "diagnosis": "Events/status mention quota/rate limit.",
      "fix": "Request quota increase; reduce reconcile rate."
    },
    {
      "cause": "Spec/CRD mismatch",
      "description": "Missing/old CRDs or incorrect fields.",
      "diagnosis": "kubectl describe managed resource; check conditions.",
      "fix": "Install correct CRDs/providers; fix spec per API."
    }
  ],
  "diagnostic_commands": [
    "kubectl get providers.pkg.crossplane.io",
    "kubectl get managed -A",
    "kubectl describe <managed-kind> -n <ns> <name>",
    "kubectl logs -n crossplane-system deploy/<provider> | tail -n 100",
    "kubectl get events -A --sort-by=.lastTimestamp | tail -n 50"
  ],
  "investigation_flow": [
    "1) Check controller/provider health (pods/events).",
    "2) Describe managed resource for conditions; look for auth/quota/spec errors.",
    "3) Verify credentials/secrets and cloud permissions.",
    "4) If quota/rate limit → wait/back off; request quota increase.",
    "5) Fix spec/CRD mismatches; ensure provider versions align.",
    "6) Reconcile/retry; confirm managed resource Ready and cloud resource created."
  ]
}
