{
  "id": "resource-limits-troubleshooting",
  "title": "Resource Limits & Requests (CPU/Memory/Evictions)",
  "category": "troubleshooting",
  "tags": [
    "cpu",
    "memory",
    "limits",
    "requests",
    "eviction",
    "throttling",
    "oom"
  ],
  "summary": "Diagnose CPU throttling, memory pressure, and evictions by comparing usage vs requests/limits and node capacity.",
  "error_patterns": [
    "evicted",
    "ExceededGracePeriod",
    "cpu throttling",
    "Out of memory",
    "memory pressure",
    "Insufficient cpu/memory"
  ],
  "recommended_tools": [
    "TOP_PODS",
    "TOP_NODES (via RUN_KUBECTL top nodes)",
    "DESCRIBE Pod <ns>/<pod>",
    "GET_EVENTS <ns>",
    "FIND_ISSUES"
  ],
  "quick_fix": "Check pod usage vs requests/limits (kubectl top pod; get pod -o yaml | grep resources). Adjust requests/limits to match reality; add capacity if nodes are saturated.",
  "symptoms": [
    "Pods throttled or slow",
    "Evictions under memory pressure",
    "Pending due to Insufficient cpu/memory",
    "OOMKilled"
  ],
  "decision_tree": [
    "If throttling (CPU) → raise CPU limit or reduce CPU load; consider HPA.",
    "If OOM/eviction → raise memory request/limit or reduce footprint; add capacity.",
    "If Pending for Insufficient cpu/memory → lower requests or add nodes; binpack sensibly.",
    "If node pressure events → spread workload; check noisy neighbors."
  ],
  "common_causes": [
    {
      "cause": "Under-requesting/overusing resources",
      "description": "Actual usage > limits/requests.",
      "diagnosis": "kubectl top pod vs spec resources.",
      "fix": "Adjust requests/limits to match real usage; optimize app."
    },
    {
      "cause": "Node-level pressure",
      "description": "Nodes out of memory/CPU; kubelet evicts.",
      "diagnosis": "kubectl top nodes; events show eviction due to pressure.",
      "fix": "Add nodes; rebalance; set realistic limits to avoid eviction."
    },
    {
      "cause": "Aggressive limits causing throttling",
      "description": "CPU limit too low; throttling.",
      "diagnosis": "Metrics show throttling; high CPU usage vs low limits.",
      "fix": "Increase CPU limit; tune requests; enable HPA."
    }
  ],
  "diagnostic_commands": [
    "kubectl top pod -n <ns> <pod>",
    "kubectl get pod -n <ns> <pod> -o jsonpath='{.spec.containers[*].resources}'",
    "kubectl top nodes",
    "kubectl describe pod -n <ns> <pod> | sed -n '/Events/,$p'",
    "kubectl get events -A --sort-by=.lastTimestamp | tail -n 30"
  ],
  "investigation_flow": [
    "1) Check usage: kubectl top pod -n <ns> <pod> (CPU/mem).",
    "2) Check spec: kubectl get pod -n <ns> <pod> -o yaml | grep -A5 resources.",
    "3) If usage > limits → increase limits/requests or optimize.",
    "4) If node pressure/evictions → check top nodes; add capacity or rebalance.",
    "5) If Pending Insufficient cpu/memory → lower requests or add nodes.",
    "6) Validate: monitor after changes; ensure no throttling/evictions."
  ]
}
