{
    "id": "crossplane-azure-providers-troubleshooting",
    "title": "Crossplane Azure Providers Troubleshooting",
    "category": "troubleshooting",
    "tags": [
        "crossplane",
        "azure",
        "upbound",
        "provider",
        "storage",
        "keyvault",
        "network",
        "compute",
        "containerservice",
        "aks",
        "managed"
    ],
    "summary": "Troubleshooting Crossplane Azure providers (azure.upbound.io) for managing Azure resources",
    "providers": {
        "provider-family-azure": "Core Azure provider family",
        "provider-azure-storage": "Azure Storage (storage accounts, containers, blobs)",
        "provider-azure-keyvault": "Azure Key Vault (secrets, keys, certificates)",
        "provider-azure-network": "Azure Networking (VNets, subnets, NSGs, load balancers)",
        "provider-azure-compute": "Azure Compute (VMs, disks, availability sets)",
        "provider-azure-containerservice": "Azure Kubernetes Service (AKS clusters, node pools)",
        "provider-azure-sql": "Azure SQL Database and managed instances",
        "provider-azure-cosmosdb": "Azure Cosmos DB accounts and databases",
        "provider-azure-eventhub": "Azure Event Hub namespaces and hubs",
        "provider-azure-cache": "Azure Cache for Redis",
        "provider-azure-managedidentity": "Azure Managed Identity",
        "provider-azure-authorization": "Azure RBAC and role assignments"
    },
    "common_causes": [
        {
            "cause": "Provider not healthy",
            "description": "Crossplane Azure provider pod is not running",
            "diagnosis": "kubectl get providers.pkg.crossplane.io, look for HEALTHY=False",
            "fix": "kubectl describe provider <name>, check operator logs"
        },
        {
            "cause": "ProviderConfig credentials issue",
            "description": "Azure credentials not configured or expired",
            "diagnosis": "kubectl get providerconfig, kubectl describe providerconfig",
            "fix": "Update Azure credentials secret, verify service principal or managed identity"
        },
        {
            "cause": "Managed resource stuck",
            "description": "Azure resource not syncing (conditions show errors)",
            "diagnosis": "kubectl describe <resource-type> <name>",
            "fix": "Check Azure portal for resource state, verify permissions"
        },
        {
            "cause": "Azure API errors",
            "description": "Azure returning 400/403/404 errors",
            "diagnosis": "Check managed resource conditions for Azure error messages",
            "fix": "Verify Azure subscription quota, permissions, resource naming"
        },
        {
            "cause": "Cross-resource references",
            "description": "Resource waiting on dependencies (VNet, subnet, etc.)",
            "diagnosis": "Check status.conditions for dependency errors",
            "fix": "Ensure referenced resources exist and are Ready"
        }
    ],
    "managed_resources": {
        "ResourceGroup": "Azure resource group container",
        "Account (storage)": "Storage account for blobs, files, queues",
        "Vault (keyvault)": "Key Vault for secrets and keys",
        "VirtualNetwork": "Azure VNet for networking",
        "Subnet": "Subnet within a VNet",
        "KubernetesCluster": "AKS cluster",
        "KubernetesClusterNodePool": "AKS node pool"
    },
    "diagnostic_commands": [
        "kubectl get providers.pkg.crossplane.io",
        "kubectl get providerconfigs.azure.upbound.io",
        "kubectl get managed",
        "kubectl describe <resource-type> <name>",
        "kubectl get accounts.storage.azure.upbound.io",
        "kubectl get vaults.keyvault.azure.upbound.io",
        "kubectl get kubernetesclusters.containerservice.azure.upbound.io"
    ],
    "fix_steps": [
        "1. Check provider health: kubectl get providers.pkg.crossplane.io",
        "2. Verify ProviderConfig exists with valid credentials",
        "3. Describe failing managed resource for conditions",
        "4. Check Azure portal for actual resource state",
        "5. Review provider pod logs for Azure API errors"
    ]
}