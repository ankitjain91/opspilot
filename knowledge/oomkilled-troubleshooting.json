{
    "id": "oomkilled-troubleshooting",
    "title": "OOMKilled and Memory Issues Troubleshooting",
    "category": "troubleshooting",
    "tags": [
        "oom",
        "oomkilled",
        "memory",
        "limit",
        "resources",
        "killed",
        "exit137",
        "outofmemory"
    ],
    "summary": "Troubleshooting containers killed due to memory exhaustion (OOMKilled, exit code 137)",
    "error_patterns": [
        "OOMKilled",
        "exit code 137",
        "Killed",
        "memory.*exceeded",
        "Out of memory",
        "cannot allocate memory"
    ],
    "recommended_tools": [
        "DESCRIBE",
        "TOP_PODS",
        "GET_LOGS",
        "FIND_ISSUES"
    ],
    "quick_fix": "kubectl describe pod <pod> | grep -A5 'Last State' && kubectl top pod <pod>",
    "symptoms": [
        "Pod status shows OOMKilled",
        "Exit code 137 in container status",
        "Container restarts with increasing memory usage",
        "Application becomes slow before crashing"
    ],
    "common_causes": [
        {
            "cause": "Memory limit too low",
            "description": "App needs more memory than limit allows",
            "diagnosis": "Compare actual usage (kubectl top) vs limit in spec",
            "fix": "Increase resources.limits.memory"
        },
        {
            "cause": "Memory leak in application",
            "description": "App gradually consumes more memory until killed",
            "diagnosis": "Watch memory grow over time with kubectl top pod --watch",
            "fix": "Fix application memory leak, add profiling"
        },
        {
            "cause": "JVM heap misconfiguration",
            "description": "Java app heap larger than container limit",
            "diagnosis": "Check -Xmx setting vs container memory limit",
            "fix": "Set -Xmx to ~75% of container memory limit"
        },
        {
            "cause": "No memory limit set",
            "description": "Pod killed by node when node runs out of memory",
            "diagnosis": "Check if resources.limits.memory is defined",
            "fix": "Set appropriate memory limits to protect pod from node eviction"
        }
    ],
    "diagnostic_commands": [
        "kubectl describe pod <pod> -n <ns> | grep -A10 'Last State'",
        "kubectl top pod <pod> -n <ns>",
        "kubectl get pod <pod> -o jsonpath='{.spec.containers[*].resources}'",
        "kubectl top nodes"
    ],
    "investigation_flow": [
        "1. Confirm OOMKilled: kubectl describe pod - check lastState.terminated.reason",
        "2. Check current usage: kubectl top pod <pod>",
        "3. Check configured limits: kubectl get pod -o yaml | grep -A5 resources",
        "4. Compare usage vs limits",
        "5. If usage < limit but OOM: check node pressure, other pods",
        "6. Fix: increase limit or fix memory leak"
    ]
}